# Description: Video Acceleration (VA) API for Linux
# URL:         https://intel.github.io/libva/index.html
# Depends on:  libdrm libglvnd xorg-libxfixes

# Maintainer notes on dependencies:
#   wayland-protocols: build with VA/Wayland API support (enabled if installed)
#   enable_docs=false: or needs doxygen to build documentation (disabled)

name=libva
version=2.23.0
release=1
source=https://github.com/intel/libva/archive/$version/libva-$version.tar.gz

build() {
	if pkgman isinst wayland-protocols >/dev/null 2>&1; then
		_meson_args="-D with_x11=no -D with_wayland=yes"
	else
		_meson_args="-D with_x11=yes -D with_wayland=no"
	fi

	meson setup build libva-$version \
		--prefix=/usr \
		--buildtype=plain \
		--wrap-mode=nodownload \
		-D b_lto=true \
		-D b_pie=true \
		-D enable_docs=false \
		-D with_win32=no \
		$_meson_args

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install
}
